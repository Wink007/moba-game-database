#!/bin/bash

# Скрипт для тестування REST API
# Використання: bash test_api.sh

BASE_URL="http://localhost:5000"

echo "╔═══════════════════════════════════════════════════════════════╗"
echo "║  🌐 ТЕСТУВАННЯ REST API                                      ║"
echo "╚═══════════════════════════════════════════════════════════════╝"
echo ""

# Перевірити чи працює сервер
echo "Перевірка сервера..."
if ! curl -s --connect-timeout 2 "$BASE_URL/api/games" > /dev/null 2>&1; then
    echo "❌ Сервер не відповідає на $BASE_URL"
    echo ""
    echo "💡 Запустіть сервер у іншому терміналі:"
    echo "   cd /tmp/game_database"
    echo "   python3 api_server.py"
    echo ""
    exit 1
fi

echo "✅ Сервер працює!"
echo ""

# Тест 1: Всі ігри
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "1️⃣  GET /api/games - Всі ігри"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
curl -s "$BASE_URL/api/games" | python3 -m json.tool
echo ""

# Тест 2: Конкретна гра
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "2️⃣  GET /api/games/1 - Гра за ID"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
curl -s "$BASE_URL/api/games/1" | python3 -m json.tool
echo ""

# Тест 3: Герої без навичок
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "3️⃣  GET /api/games/1/heroes - Герої (без навичок)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
curl -s "$BASE_URL/api/games/1/heroes" | python3 -m json.tool | head -30
echo ""

# Тест 4: Предмети
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "4️⃣  GET /api/games/1/items - Предмети гри"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
curl -s "$BASE_URL/api/games/1/items" | python3 -m json.tool | head -40
echo ""

# Тест 5: Статистика
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "5️⃣  GET /api/games/1/stats - Статистика"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
curl -s "$BASE_URL/api/games/1/stats" | python3 -m json.tool
echo ""

# Тест 6: Пошук
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "6️⃣  GET /api/search/items - Пошук предметів"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
curl -s "$BASE_URL/api/search/items?game_id=1&query=Black" | python3 -m json.tool
echo ""

echo "╔═══════════════════════════════════════════════════════════════╗"
echo "║  ✅ ВСІНАПИТИ ВИКОНАНО УСПІШНО!                              ║"
echo "╚═══════════════════════════════════════════════════════════════╝"
